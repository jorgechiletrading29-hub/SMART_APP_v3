<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Financiera - Smart Student</title>
  <link rel="stylesheet" href="shared-styles.css">
  <style>
    .balance-card {
      background: linear-gradient(135deg, #059669 0%, #10b981 100%);
      border-radius: 16px;
      padding: 24px;
      text-align: center;
      margin-bottom: 20px;
    }
    .balance-label { font-size: 14px; opacity: 0.9; }
    .balance-value { font-size: 36px; font-weight: 700; margin: 8px 0; }
    .balance-status { font-size: 13px; opacity: 0.8; }
    .balance-status.debt { color: #fca5a5; }
    .payment-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }
    .payment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .payment-concept { font-weight: 600; font-size: 15px; }
    .payment-amount { font-size: 18px; font-weight: 700; }
    .payment-amount.paid { color: #22c55e; }
    .payment-amount.pending { color: #ef4444; }
    .payment-meta {
      display: flex;
      gap: 12px;
      font-size: 12px;
      color: var(--text-muted);
    }
    .month-section {
      margin-bottom: 24px;
    }
    .month-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-muted);
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border-color);
    }
  </style>
</head>
<body>
  <!-- Fixed Top Navigation -->
  <nav class="top-nav">
    <div class="nav-left">
      <div class="nav-logo" onclick="goHome()">
        <svg viewBox="0 0 100 100">
          <path d="M30 55 Q30 65 35 70 Q45 80 50 80 Q55 80 65 70 Q70 65 70 55 L70 50 Q70 45 65 42 Q55 35 50 35 Q45 35 35 42 Q30 45 30 50 Z" fill="#1976D2"/>
          <path d="M15 40 L50 25 L85 40 L50 55 Z" fill="#2196F3"/>
          <path d="M15 40 L50 55 L50 57 L13 41 Z" fill="#1565C0"/>
          <path d="M85 40 L50 55 L50 57 L87 41 Z" fill="#1565C0"/>
          <circle cx="50" cy="40" r="3" fill="#0D47A1"/>
          <path d="M50 40 Q60 45 70 40 Q80 35 82 55 Q84 65 82 75" stroke="#1A1A1A" stroke-width="2" fill="none"/>
          <rect x="78" y="73" width="8" height="4" rx="1" fill="#2A2A2A"/>
          <path d="M79 77 L79 88 Q82 90 85 88 L85 77" fill="#1A1A1A"/>
        </svg>
      </div>
      <span class="page-title" id="page-title">Financiera</span>
    </div>
    <div class="nav-right">
      <button class="nav-btn" onclick="goHome()" title="Inicio">üè†</button>
      <button class="nav-btn" onclick="goToModule('resumen')" title="Resumen">üìù</button>
      <button class="nav-btn" onclick="goToModule('mapa-mental')" title="Mapa Mental">üß†</button>
      <button class="nav-btn" onclick="goToModule('cuestionario')" title="Cuestionario">‚ùì</button>
      <button class="nav-btn" onclick="goToModule('evaluacion')" title="Evaluaci√≥n">üìã</button>
    </div>
  </nav>

  <header class="header">
    <button class="back-btn" onclick="goBack()">‚Üê</button>
    <span class="header-title">Financiera</span>
    <span class="header-icon">üí≥</span>
  </header>
  
  <main class="main-content">
    <div class="tabs">
      <button class="tab active" onclick="switchTab('status')">Estado de Cuenta</button>
      <button class="tab" onclick="switchTab('history')">Historial</button>
    </div>
    
    <!-- Estado de cuenta -->
    <div id="status-view">
      <div class="balance-card" id="balance-card">
        <div class="balance-label">Saldo Pendiente</div>
        <div class="balance-value" id="balance-value">$0</div>
        <div class="balance-status" id="balance-status">Al d√≠a</div>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" style="color: #22c55e;" id="paid-count">10</div>
          <div class="stat-label">Cuotas Pagadas</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" style="color: #ef4444;" id="pending-count">2</div>
          <div class="stat-label">Cuotas Pendientes</div>
        </div>
      </div>
      
      <h3 style="font-size: 16px; margin: 20px 0 12px;">Pr√≥ximos Pagos</h3>
      <div id="pending-payments"></div>
    </div>
    
    <!-- Historial -->
    <div id="history-view" style="display: none;">
      <div id="payment-history"></div>
    </div>
  </main>

  <script>
    var currentTab = 'status';
    
    var payments = [
      { id: '1', concept: 'Matr√≠cula 2026', amount: 150000, date: '2026-01-15', status: 'paid', month: 'Enero 2026' },
      { id: '2', concept: 'Mensualidad Marzo', amount: 85000, date: '2026-03-05', status: 'paid', month: 'Marzo 2026' },
      { id: '3', concept: 'Mensualidad Abril', amount: 85000, date: '2026-04-05', status: 'paid', month: 'Abril 2026' },
      { id: '4', concept: 'Mensualidad Mayo', amount: 85000, date: '2026-05-05', status: 'paid', month: 'Mayo 2026' },
      { id: '5', concept: 'Mensualidad Junio', amount: 85000, date: '2026-06-05', status: 'paid', month: 'Junio 2026' },
      { id: '6', concept: 'Mensualidad Julio', amount: 85000, date: '2026-07-05', status: 'paid', month: 'Julio 2026' },
      { id: '7', concept: 'Mensualidad Agosto', amount: 85000, date: '2026-08-05', status: 'paid', month: 'Agosto 2026' },
      { id: '8', concept: 'Mensualidad Septiembre', amount: 85000, date: '2026-09-05', status: 'paid', month: 'Septiembre 2026' },
      { id: '9', concept: 'Mensualidad Octubre', amount: 85000, date: '2026-10-05', status: 'paid', month: 'Octubre 2026' },
      { id: '10', concept: 'Mensualidad Noviembre', amount: 85000, date: '2026-11-05', status: 'paid', month: 'Noviembre 2026' },
      { id: '11', concept: 'Mensualidad Diciembre', amount: 85000, date: '2026-12-05', status: 'pending', month: 'Diciembre 2026' },
      { id: '12', concept: 'Mensualidad Enero 2027', amount: 85000, date: '2027-01-05', status: 'pending', month: 'Enero 2027' }
    ];
    
    function goBack() {
      window.location.href = '/dashboard-static.html';
    }
    
    function init() {
      renderStatus();
      renderHistory();
    }
    
    function switchTab(tab) {
      currentTab = tab;
      var tabs = document.querySelectorAll('.tab');
      tabs.forEach(function(t, i) {
        t.classList.toggle('active', (tab === 'status' && i === 0) || (tab === 'history' && i === 1));
      });
      document.getElementById('status-view').style.display = tab === 'status' ? 'block' : 'none';
      document.getElementById('history-view').style.display = tab === 'history' ? 'block' : 'none';
    }
    
    function renderStatus() {
      var pending = payments.filter(function(p) { return p.status === 'pending'; });
      var paid = payments.filter(function(p) { return p.status === 'paid'; });
      var totalDebt = pending.reduce(function(sum, p) { return sum + p.amount; }, 0);
      
      document.getElementById('balance-value').textContent = formatMoney(totalDebt);
      document.getElementById('paid-count').textContent = paid.length;
      document.getElementById('pending-count').textContent = pending.length;
      
      var balanceCard = document.getElementById('balance-card');
      var statusEl = document.getElementById('balance-status');
      
      if (totalDebt > 0) {
        balanceCard.style.background = 'linear-gradient(135deg, #dc2626 0%, #ef4444 100%)';
        statusEl.textContent = pending.length + ' cuota(s) pendiente(s)';
        statusEl.classList.add('debt');
      } else {
        balanceCard.style.background = 'linear-gradient(135deg, #059669 0%, #10b981 100%)';
        statusEl.textContent = '‚úì Sin deudas pendientes';
      }
      
      // Pending payments
      var html = '';
      pending.forEach(function(p) {
        html += renderPaymentCard(p);
      });
      
      if (pending.length === 0) {
        html = '<div class="empty-state"><div class="empty-state-icon">‚úÖ</div><p>No hay pagos pendientes</p></div>';
      }
      
      document.getElementById('pending-payments').innerHTML = html;
    }
    
    function renderHistory() {
      var byMonth = {};
      payments.forEach(function(p) {
        if (!byMonth[p.month]) byMonth[p.month] = [];
        byMonth[p.month].push(p);
      });
      
      var html = '';
      for (var month in byMonth) {
        html += '<div class="month-section">';
        html += '<div class="month-title">' + month + '</div>';
        byMonth[month].forEach(function(p) {
          html += renderPaymentCard(p);
        });
        html += '</div>';
      }
      
      document.getElementById('payment-history').innerHTML = html;
    }
    
    function renderPaymentCard(p) {
      var statusClass = p.status === 'paid' ? 'paid' : 'pending';
      var statusText = p.status === 'paid' ? '‚úì Pagado' : '‚è≥ Pendiente';
      var statusBadge = p.status === 'paid' ? 'badge-green' : 'badge-red';
      
      return '<div class="payment-card">' +
        '<div class="payment-header">' +
        '<div class="payment-concept">' + p.concept + '</div>' +
        '<div class="payment-amount ' + statusClass + '">' + formatMoney(p.amount) + '</div>' +
        '</div>' +
        '<div class="payment-meta">' +
        '<span>üìÖ Vencimiento: ' + formatDate(p.date) + '</span>' +
        '<span class="badge ' + statusBadge + '">' + statusText + '</span>' +
        '</div></div>';
    }
    
    function formatMoney(amount) {
      return '$' + amount.toLocaleString('es-CL');
    }
    
    function formatDate(dateStr) {
      var d = new Date(dateStr);
      return d.getDate() + '/' + (d.getMonth() + 1) + '/' + d.getFullYear();
    }
    
    document.addEventListener('DOMContentLoaded', init);
  </script>

  <script>
    // Initialize theme from localStorage
    (function() {
      var theme = localStorage.getItem('smartstudent_theme') || 'dark';
      document.documentElement.setAttribute('data-theme', theme);
    })();
    
    function goBack() {
      if (window.history.length > 1) {
        window.history.back();
      } else {
        window.location.href = '/dashboard-static.html';
      }
    }
    
    function goHome() {
      window.location.href = '/dashboard-static.html';
    }
    
    function goToModule(module) {
      window.location.href = '/modules/' + module + '.html';
    }
  </script>

</body>
</html>
