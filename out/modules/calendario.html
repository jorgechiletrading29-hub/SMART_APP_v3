<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Calendario - Smart Student</title>
  <link rel="stylesheet" href="shared-styles.css">
  <style>
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      background: var(--bg-card);
      padding: 12px 16px;
      border-radius: 12px;
    }
    .month-title {
      font-size: 18px;
      font-weight: 600;
    }
    .nav-btn {
      background: rgba(59, 130, 246, 0.2);
      color: #93c5fd;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      font-size: 18px;
      cursor: pointer;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-bottom: 20px;
    }
    .weekday {
      text-align: center;
      font-size: 11px;
      color: var(--text-muted);
      padding: 8px 0;
      font-weight: 500;
    }
    .day-cell {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      position: relative;
      background: var(--bg-card);
    }
    .day-cell.other-month {
      color: var(--text-muted);
      opacity: 0.5;
    }
    .day-cell.today {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      color: white;
      font-weight: 600;
    }
    .day-cell.selected {
      border: 2px solid #3b82f6;
    }
    .day-cell.has-event::after {
      content: '';
      position: absolute;
      bottom: 4px;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #22c55e;
    }
    .day-cell.has-event.exam::after { background: #ef4444; }
    .day-cell.has-event.deadline::after { background: #eab308; }
    
    .events-section {
      margin-top: 16px;
    }
    .section-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .event-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 10px;
    }
    .event-card.exam { border-left: 4px solid #ef4444; }
    .event-card.deadline { border-left: 4px solid #eab308; }
    .event-card.holiday { border-left: 4px solid #22c55e; }
    .event-card.meeting { border-left: 4px solid #8b5cf6; }
    .event-time {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }
    .event-title {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }
    .event-desc {
      font-size: 12px;
      color: var(--text-secondary);
    }
    .legend {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 16px;
      padding: 12px;
      background: var(--bg-card);
      border-radius: 8px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
    }
    .legend-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }
    .legend-dot.exam { background: #ef4444; }
    .legend-dot.deadline { background: #eab308; }
    .legend-dot.holiday { background: #22c55e; }
    .legend-dot.meeting { background: #8b5cf6; }
  </style>
</head>
<body>
  <!-- Fixed Top Navigation -->
  <nav class="top-nav">
    <div class="nav-left">
      <div class="nav-logo" onclick="goHome()">
        <svg viewBox="0 0 100 100">
          <path d="M30 55 Q30 65 35 70 Q45 80 50 80 Q55 80 65 70 Q70 65 70 55 L70 50 Q70 45 65 42 Q55 35 50 35 Q45 35 35 42 Q30 45 30 50 Z" fill="#1976D2"/>
          <path d="M15 40 L50 25 L85 40 L50 55 Z" fill="#2196F3"/>
          <path d="M15 40 L50 55 L50 57 L13 41 Z" fill="#1565C0"/>
          <path d="M85 40 L50 55 L50 57 L87 41 Z" fill="#1565C0"/>
          <circle cx="50" cy="40" r="3" fill="#0D47A1"/>
          <path d="M50 40 Q60 45 70 40 Q80 35 82 55 Q84 65 82 75" stroke="#1A1A1A" stroke-width="2" fill="none"/>
          <rect x="78" y="73" width="8" height="4" rx="1" fill="#2A2A2A"/>
          <path d="M79 77 L79 88 Q82 90 85 88 L85 77" fill="#1A1A1A"/>
        </svg>
      </div>
      <span class="page-title" id="page-title">Calendario</span>
    </div>
    <div class="nav-right">
      <button class="nav-btn" onclick="goHome()" title="Inicio">üè†</button>
      <button class="nav-btn" onclick="goToModule('resumen')" title="Resumen">üìù</button>
      <button class="nav-btn" onclick="goToModule('mapa-mental')" title="Mapa Mental">üß†</button>
      <button class="nav-btn" onclick="goToModule('cuestionario')" title="Cuestionario">‚ùì</button>
      <button class="nav-btn" onclick="goToModule('evaluacion')" title="Evaluaci√≥n">üìã</button>
    </div>
  </nav>

  <header class="header">
    <button class="back-btn" onclick="goBack()">‚Üê</button>
    <span class="header-title">Calendario</span>
    <span class="header-icon">üìÖ</span>
  </header>
  
  <main class="main-content">
    <div class="calendar-header">
      <button class="nav-btn" onclick="changeMonth(-1)">‚Äπ</button>
      <span class="month-title" id="month-title">Enero 2026</span>
      <button class="nav-btn" onclick="changeMonth(1)">‚Ä∫</button>
    </div>
    
    <div class="legend">
      <div class="legend-item"><span class="legend-dot exam"></span> Pruebas</div>
      <div class="legend-item"><span class="legend-dot deadline"></span> Entregas</div>
      <div class="legend-item"><span class="legend-dot holiday"></span> Feriados</div>
      <div class="legend-item"><span class="legend-dot meeting"></span> Reuniones</div>
    </div>
    
    <div class="calendar-grid" id="calendar-grid"></div>
    
    <div class="events-section">
      <div class="section-title">üìã Eventos del d√≠a</div>
      <div id="events-container"></div>
    </div>
  </main>

  <script>
    var currentDate = new Date();
    var selectedDate = new Date();
    
    var events = [
      { date: '2026-01-06', type: 'holiday', title: 'Feriado: D√≠a de Reyes', time: 'Todo el d√≠a' },
      { date: '2026-01-10', type: 'exam', title: 'Prueba de Matem√°ticas', time: '10:00 AM', desc: 'Unidad de fracciones y decimales' },
      { date: '2026-01-12', type: 'deadline', title: 'Entrega ensayo Historia', time: '23:59', desc: 'Revoluci√≥n Francesa' },
      { date: '2026-01-15', type: 'meeting', title: 'Reuni√≥n de apoderados', time: '18:00', desc: 'Sal√≥n multiuso' },
      { date: '2026-01-20', type: 'exam', title: 'Prueba de Lenguaje', time: '09:00 AM', desc: 'Comprensi√≥n lectora' },
      { date: '2026-01-25', type: 'deadline', title: 'Proyecto de Ciencias', time: '12:00', desc: 'Maqueta sistema solar' },
      { date: '2026-02-03', type: 'holiday', title: 'Inicio vacaciones verano', time: 'Todo el d√≠a' },
      { date: '2026-02-15', type: 'meeting', title: 'Consejo escolar', time: '14:00', desc: 'Planificaci√≥n semestre' }
    ];
    
    var months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                  'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
    var weekdays = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
    
    function goBack() {
      window.location.href = '/dashboard-static.html';
    }
    
    function init() {
      renderCalendar();
      renderEvents();
    }
    
    function changeMonth(delta) {
      currentDate.setMonth(currentDate.getMonth() + delta);
      renderCalendar();
    }
    
    function formatDateKey(d) {
      var year = d.getFullYear();
      var month = String(d.getMonth() + 1).padStart(2, '0');
      var day = String(d.getDate()).padStart(2, '0');
      return year + '-' + month + '-' + day;
    }
    
    function getEventsForDate(dateKey) {
      return events.filter(function(e) { return e.date === dateKey; });
    }
    
    function renderCalendar() {
      var year = currentDate.getFullYear();
      var month = currentDate.getMonth();
      
      document.getElementById('month-title').textContent = months[month] + ' ' + year;
      
      var firstDay = new Date(year, month, 1);
      var lastDay = new Date(year, month + 1, 0);
      var startDay = firstDay.getDay();
      
      var html = '';
      
      weekdays.forEach(function(w) {
        html += '<div class="weekday">' + w + '</div>';
      });
      
      var today = new Date();
      today.setHours(0, 0, 0, 0);
      
      var prevMonthLastDay = new Date(year, month, 0).getDate();
      for (var i = startDay - 1; i >= 0; i--) {
        var d = prevMonthLastDay - i;
        html += '<div class="day-cell other-month">' + d + '</div>';
      }
      
      for (var day = 1; day <= lastDay.getDate(); day++) {
        var cellDate = new Date(year, month, day);
        var dateKey = formatDateKey(cellDate);
        var dayEvents = getEventsForDate(dateKey);
        
        var classes = 'day-cell';
        
        if (cellDate.getTime() === today.getTime()) {
          classes += ' today';
        }
        
        if (formatDateKey(cellDate) === formatDateKey(selectedDate)) {
          classes += ' selected';
        }
        
        if (dayEvents.length > 0) {
          classes += ' has-event';
          if (dayEvents.some(function(e) { return e.type === 'exam'; })) {
            classes += ' exam';
          } else if (dayEvents.some(function(e) { return e.type === 'deadline'; })) {
            classes += ' deadline';
          }
        }
        
        html += '<div class="' + classes + '" onclick="selectDate(' + year + ',' + month + ',' + day + ')">' + day + '</div>';
      }
      
      var remaining = 42 - (startDay + lastDay.getDate());
      for (var j = 1; j <= remaining && j <= 7; j++) {
        html += '<div class="day-cell other-month">' + j + '</div>';
      }
      
      document.getElementById('calendar-grid').innerHTML = html;
    }
    
    function selectDate(year, month, day) {
      selectedDate = new Date(year, month, day);
      renderCalendar();
      renderEvents();
    }
    
    function renderEvents() {
      var dateKey = formatDateKey(selectedDate);
      var dayEvents = getEventsForDate(dateKey);
      
      if (dayEvents.length === 0) {
        document.getElementById('events-container').innerHTML = 
          '<div class="empty-state" style="padding: 20px;"><div class="empty-state-icon">üì≠</div><p>No hay eventos para este d√≠a</p></div>';
        return;
      }
      
      var html = '';
      dayEvents.forEach(function(e) {
        html += '<div class="event-card ' + e.type + '">';
        html += '<div class="event-time">' + e.time + '</div>';
        html += '<div class="event-title">' + escapeHtml(e.title) + '</div>';
        if (e.desc) {
          html += '<div class="event-desc">' + escapeHtml(e.desc) + '</div>';
        }
        html += '</div>';
      });
      
      document.getElementById('events-container').innerHTML = html;
    }
    
    function escapeHtml(t) {
      var d = document.createElement('div');
      d.textContent = t;
      return d.innerHTML;
    }
    
    document.addEventListener('DOMContentLoaded', init);
  </script>

  <script>
    // Initialize theme from localStorage
    (function() {
      var theme = localStorage.getItem('smartstudent_theme') || 'dark';
      document.documentElement.setAttribute('data-theme', theme);
    })();
    
    function goBack() {
      if (window.history.length > 1) {
        window.history.back();
      } else {
        window.location.href = '/dashboard-static.html';
      }
    }
    
    function goHome() {
      window.location.href = '/dashboard-static.html';
    }
    
    function goToModule(module) {
      window.location.href = '/modules/' + module + '.html';
    }
  </script>

</body>
</html>
